"use strict";(self.webpackChunksonic_scribe=self.webpackChunksonic_scribe||[]).push([[678],{4814:function(t,e,n){n.r(e),n.d(e,{Head:function(){return T},default:function(){return w}});var r=n(7294),i=n(5100),a=n(3688);function o(t){let{noteSequence:e}=t;const n=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(e){let t=e;t.quantizationInfo||(t=(0,i.ef)(e,4));new a.Lh(t,n.current).redraw()}}),[e]),r.createElement("div",{ref:n})}var s=n(5131);const c={1:"1024th",2:"512th",4:"256th",8:"128th",16:"64th",32:"32th",64:"16th",128:"eighth",256:"quarter",512:"half",1024:"whole",2048:"breve",4096:"long",8192:"maxima"};function l(t){return{step:{0:"A",1:"A",2:"B",3:"C",4:"C",5:"D",6:"D",7:"E",8:"F",9:"F",10:"G",11:"G"}[(t-21)%12],alter:{0:0,1:1,2:0,3:0,4:1,5:0,6:1,7:0,8:0,9:1,10:0,11:1}[(t-21)%12],octave:Math.floor((t-12)/12)}}var u=n(9282),m=n(8784);let d,p=!1;async function f(){return p||(console.log("Downloading Model ..."),d=new m.S("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),await d.initialize(),p=!0),!0}async function h(t){const e=await function(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=n=>{const i=r.result,a=new Blob([i],{type:t.type});e(a)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(t);p||await f();const n=await d.transcribeFromAudioFile(e);return console.log(n),n}var w=()=>{const{0:t,1:e}=(0,r.useState)(!1),{0:n,1:m}=(0,r.useState)(null),{0:d,1:p}=(0,r.useState)(null);function w(t,e,n){const r=new Blob([t],{type:n}),i=URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}return(0,r.useEffect)((()=>{(async()=>{try{e(await f())}catch(t){console.error("Error initializing model:",t)}})()}),[]),(0,r.useEffect)((()=>{if(n&&t)if("mid"===n.name.split(".")[1]||"midi"===n.name.split(".")[1]){function e(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=t=>{const n=r.result;e(n)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(async()=>{p(a.eo(await e(n)))})()}else{(async()=>{try{let t=await h(n);p(t)}catch(t){console.error("Error transcribing file:",t)}})()}}),[n,t]),r.createElement(r.Fragment,null,t?r.createElement(r.Fragment,null,r.createElement(u.Z,{onFileUpload:m}),n&&(d?r.createElement(r.Fragment,null,r.createElement(s.Z,{noteSequence:d}),r.createElement(o,{noteSequence:d})):r.createElement("p",null,"Transcribing ..."))):r.createElement("p",null,"Loading Model..."),r.createElement("button",{onClick:()=>{const t=function(t){let e=new a.lZ(t);e.tempos[0].qpm||(e=(0,i.ef)(t));const n=60/(256*e.tempos[0].qpm);let r='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\t<!DOCTYPE score-partwise PUBLIC\n\t\t"-//Recordare//DTD MusicXML 4.0 Partwise//EN"\n\t\t"http://www.musicxml.org/dtds/partwise.dtd">\n\t<score-partwise version="4.0">\n\t  \t<part-list>\n\t\t\t<score-part id="P1">\n\t\t  \t\t<part-name>Music</part-name>\n\t\t\t</score-part>\n\t  \t</part-list>\n\t  \t<part id="P1">\n\t\t  \t',o=e.notes.slice().map((t=>({pitch:t.pitch,startTime:t.startTime,endTime:t.endTime,duration:Math.round((t.endTime-t.startTime)/n),noteType:c[Math.round((t.endTime-t.startTime)/n)],tied:null})));o.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime));let s=[];for(let i=0;i<o.length;i++)for(s.push(o[i]);!s[s.length-1].noteType;)for(let t of Object.keys(c).sort(((t,e)=>e-t)))if(s[s.length-1].duration>t){s[s.length-1].noteType=c[t];break}s.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime)),r+='\n\t\t\t\t<measure number="1">\n\t\t\t\t<attributes>\n\t\t\t\t\t<divisions>256</divisions>\n\t\t\t\t\t<key>\n\t\t\t\t\t  <fifths>0</fifths>\n\t\t\t\t\t</key>\n\t\t\t\t\t<time>\n\t\t\t\t\t  <beats>4</beats>\n\t\t\t\t\t  <beat-type>4</beat-type>\n\t\t\t\t\t</time>\n\t\t\t\t\t<staves>2</staves>\n\t\t\t\t  <clef number="1">\n\t\t\t\t\t\t<sign>G</sign>\n\t\t\t\t\t\t<line>2</line>\n\t\t\t\t  </clef>\n\t\t\t\t  <clef number="2">\n\t\t\t\t\t\t<sign>F</sign>\n\t\t\t\t\t\t<line>4</line>\n\t\t\t\t  </clef>\n\t\t\t  </attributes>';for(let[i,a]of s.entries())r+=`\n\t\t\t<note>\n\t\t\t\t${i>0&&s[i-1].startTime===a.startTime?"<chord />":""}\n\t\t\t\t<pitch>\n\t\t\t\t\t  <step>${l(a.pitch).step}</step>\n\t\t\t\t\t<alter>${l(a.pitch).alter}</alter>\n\t\t\t\t\t  <octave>${l(a.pitch).octave}</octave>\n\t\t\t\t</pitch>\n\t\t\t\t<duration>${a.duration}</duration>\n\t\t\t\t<type>${a.noteType}</type>\n\t\t\t\t${a.tied?a.tied:""}\n\t\t\t</note>\n\t\t\t`;return r+="\n\t\t\t\t</measure>",r+="\n\t\t</part>\n\t</score-partwise>",r}(d);w(t,"music.xml","application/octet-stream")}},"Download MusicXML"),r.createElement("button",{onClick:()=>{w(a.pi(d),"music.midi","application/octet-stream")}},"Download MIDI"))};const T=()=>r.createElement("title",null,"Test Page")}}]);
//# sourceMappingURL=component---src-pages-index-js-46136d5544692b41223b.js.map