"use strict";(self.webpackChunksonic_scribe=self.webpackChunksonic_scribe||[]).push([[678],{6621:function(t,e,n){n.r(e),n.d(e,{Head:function(){return F},default:function(){return A}});var r=n(7294),o=n(5100),s=n(3688);n(5131);const i={1:"1024th",2:"512th",4:"256th",8:"128th",16:"64th",32:"32th",64:"16th",128:"eighth",256:"quarter",512:"half",1024:"whole",2048:"breve",4096:"long",8192:"maxima"};function a(t){return{step:{0:"A",1:"A",2:"B",3:"C",4:"C",5:"D",6:"D",7:"E",8:"F",9:"F",10:"G",11:"G"}[(t-21)%12],alter:{0:0,1:1,2:0,3:0,4:1,5:0,6:1,7:0,8:0,9:1,10:0,11:1}[(t-21)%12],octave:Math.floor((t-12)/12)}}n(9282);var c=n(8784);const l=(t,e)=>e.some((e=>t instanceof e));let u,d;const m=new WeakMap,p=new WeakMap,f=new WeakMap,h=new WeakMap,w=new WeakMap;let b={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return p.get(t);if("objectStoreNames"===e)return t.objectStoreNames||f.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function g(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(T(this),e),v(m.get(this))}:function(...e){return v(t.apply(T(this),e))}:function(e,...n){const r=t.call(T(this),e,...n);return f.set(r,e.sort?e.sort():[e]),v(r)}}function y(t){return"function"==typeof t?g(t):(t instanceof IDBTransaction&&function(t){if(p.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)}));p.set(t,e)}(t),l(t,u||(u=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,b):t)}function v(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{e(v(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&m.set(e,t)})).catch((()=>{})),w.set(e,t),e}(t);if(h.has(t))return h.get(t);const e=y(t);return e!==t&&(h.set(t,e),w.set(e,t)),e}const T=t=>w.get(t);const D=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],B=new Map;function I(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(B.get(e))return B.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!D.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,o?"readwrite":"readonly");let i=s.store;return r&&(i=i.index(e.shift())),(await Promise.all([i[n](...e),o&&s.done]))[0]};return B.set(e,s),s}let k;b=(t=>({...t,get:(e,n,r)=>I(e,n)||t.get(e,n,r),has:(e,n)=>!!I(e,n)||t.has(e,n)}))(b);let L=!1;async function M(){if(L)return!0;const t=await function(t,e,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const i=indexedDB.open(t,e),a=v(i);return r&&i.addEventListener("upgradeneeded",(t=>{r(v(i.result),t.oldVersion,t.newVersion,v(i.transaction),t)})),n&&i.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),o&&t.addEventListener("versionchange",(t=>o(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("my-database",1,{upgrade(t){t.createObjectStore("models")}});return k=await t.get("models","onsetsAndFrames"),k?console.log("Found model in indexedDB!"):(console.log("Downloading Model ..."),k=new c.S("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),await k.initialize(),await t.put("models",k,"onsetsAndFrames")),L=!0,!0}async function C(t){const e=await function(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=n=>{const o=r.result,s=new Blob([o],{type:t.type});e(s)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(t);L||await M();const n=await k.transcribeFromAudioFile(e);return console.log(n),n}var A=()=>{const{0:t,1:e}=(0,r.useState)(!1),{0:n,1:c}=(0,r.useState)(null),{0:l,1:u}=(0,r.useState)(null);function d(t,e,n){const r=new Blob([t],{type:n}),o=URL.createObjectURL(r),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}return(0,r.useEffect)((()=>{(async()=>{try{e(await M())}catch(t){console.error("Error initializing model:",t)}})()}),[]),(0,r.useEffect)((()=>{if(n&&t)if("mid"===n.name.split(".")[1]||"midi"===n.name.split(".")[1]){function e(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=t=>{const n=r.result;e(n)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(async()=>{u(s.eo(await e(n)))})()}else{(async()=>{try{let t=await C(n);u(t)}catch(t){console.error("Error transcribing file:",t)}})()}}),[n,t]),r.createElement(r.Fragment,null,r.createElement("button",{onClick:()=>{const t=function(t){let e=new s.lZ(t);e.tempos[0].qpm||(e=(0,o.ef)(t));const n=60/(256*e.tempos[0].qpm);let r='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\t<!DOCTYPE score-partwise PUBLIC\n\t\t"-//Recordare//DTD MusicXML 4.0 Partwise//EN"\n\t\t"http://www.musicxml.org/dtds/partwise.dtd">\n\t<score-partwise version="4.0">\n\t  \t<part-list>\n\t\t\t<score-part id="P1">\n\t\t  \t\t<part-name>Music</part-name>\n\t\t\t</score-part>\n\t  \t</part-list>\n\t  \t<part id="P1">\n\t\t  \t',c=e.notes.slice().map((t=>({pitch:t.pitch,startTime:t.startTime,endTime:t.endTime,duration:Math.round((t.endTime-t.startTime)/n),noteType:i[Math.round((t.endTime-t.startTime)/n)],tied:null})));c.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime));let l=[];for(let o=0;o<c.length;o++)for(l.push(c[o]);!l[l.length-1].noteType;)for(let t of Object.keys(i).sort(((t,e)=>e-t)))if(l[l.length-1].duration>t){l[l.length-1].noteType=i[t];break}l.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime)),r+='\n\t\t\t\t<measure number="1">\n\t\t\t\t<attributes>\n\t\t\t\t\t<divisions>256</divisions>\n\t\t\t\t\t<key>\n\t\t\t\t\t  <fifths>0</fifths>\n\t\t\t\t\t</key>\n\t\t\t\t\t<time>\n\t\t\t\t\t  <beats>4</beats>\n\t\t\t\t\t  <beat-type>4</beat-type>\n\t\t\t\t\t</time>\n\t\t\t\t\t<staves>2</staves>\n\t\t\t\t  <clef number="1">\n\t\t\t\t\t\t<sign>G</sign>\n\t\t\t\t\t\t<line>2</line>\n\t\t\t\t  </clef>\n\t\t\t\t  <clef number="2">\n\t\t\t\t\t\t<sign>F</sign>\n\t\t\t\t\t\t<line>4</line>\n\t\t\t\t  </clef>\n\t\t\t  </attributes>';for(let[o,s]of l.entries())r+=`\n\t\t\t<note>\n\t\t\t\t${o>0&&l[o-1].startTime===s.startTime?"<chord />":""}\n\t\t\t\t<pitch>\n\t\t\t\t\t  <step>${a(s.pitch).step}</step>\n\t\t\t\t\t<alter>${a(s.pitch).alter}</alter>\n\t\t\t\t\t  <octave>${a(s.pitch).octave}</octave>\n\t\t\t\t</pitch>\n\t\t\t\t<duration>${s.duration}</duration>\n\t\t\t\t<type>${s.noteType}</type>\n\t\t\t\t${s.tied?s.tied:""}\n\t\t\t</note>\n\t\t\t`;return r+="\n\t\t\t\t</measure>",r+="\n\t\t</part>\n\t</score-partwise>",r}(l);d(t,"music.xml","application/octet-stream")}},"Download MusicXML"),r.createElement("button",{onClick:()=>{d(s.pi(l),"music.midi","application/octet-stream")}},"Download MIDI"))};const F=()=>r.createElement("title",null,"Home Page")}}]);
//# sourceMappingURL=component---src-pages-index-js-69c8f7a89ab984464209.js.map