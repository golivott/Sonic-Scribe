"use strict";(self.webpackChunksonic_scribe=self.webpackChunksonic_scribe||[]).push([[678],{6621:function(t,e,n){n.r(e),n.d(e,{Head:function(){return x},default:function(){return j}});var r=n(7294),o=n(5100),s=n(3688);function a(t){let{noteSequence:e}=t;const n=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(e){let t=e;t.quantizationInfo||(t=(0,o.ef)(e,4));new s.Lh(t,n.current).redraw()}}),[e]),r.createElement("div",{ref:n})}var i=n(5131);const c={1:"1024th",2:"512th",4:"256th",8:"128th",16:"64th",32:"32th",64:"16th",128:"eighth",256:"quarter",512:"half",1024:"whole",2048:"breve",4096:"long",8192:"maxima"};function l(t){return{step:{0:"A",1:"A",2:"B",3:"C",4:"C",5:"D",6:"D",7:"E",8:"F",9:"F",10:"G",11:"G"}[(t-21)%12],alter:{0:0,1:1,2:0,3:0,4:1,5:0,6:1,7:0,8:0,9:1,10:0,11:1}[(t-21)%12],octave:Math.floor((t-12)/12)}}var u=n(9282),d=n(8784);const m=(t,e)=>e.some((e=>t instanceof e));let p,f;const h=new WeakMap,g=new WeakMap,b=new WeakMap,w=new WeakMap,v=new WeakMap;let y={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return g.get(t);if("objectStoreNames"===e)return t.objectStoreNames||b.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return D(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function E(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(I(this),e),D(h.get(this))}:function(...e){return D(t.apply(I(this),e))}:function(e,...n){const r=t.call(I(this),e,...n);return b.set(r,e.sort?e.sort():[e]),D(r)}}function T(t){return"function"==typeof t?E(t):(t instanceof IDBTransaction&&function(t){if(g.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)}));g.set(t,e)}(t),m(t,p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,y):t)}function D(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{e(D(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&h.set(e,t)})).catch((()=>{})),v.set(e,t),e}(t);if(w.has(t))return w.get(t);const e=T(t);return e!==t&&(w.set(t,e),v.set(e,t)),e}const I=t=>v.get(t);const B=["get","getKey","getAll","getAllKeys","count"],L=["put","add","delete","clear"],k=new Map;function M(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(k.get(e))return k.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=L.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!B.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,o?"readwrite":"readonly");let a=s.store;return r&&(a=a.index(e.shift())),(await Promise.all([a[n](...e),o&&s.done]))[0]};return k.set(e,s),s}let S;y=(t=>({...t,get:(e,n,r)=>M(e,n)||t.get(e,n,r),has:(e,n)=>!!M(e,n)||t.has(e,n)}))(y);let C=!1;async function F(){if(C)return!0;const t=await function(t,e,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const a=indexedDB.open(t,e),i=D(a);return r&&a.addEventListener("upgradeneeded",(t=>{r(D(a.result),t.oldVersion,t.newVersion,D(a.transaction),t)})),n&&a.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),i.then((t=>{s&&t.addEventListener("close",(()=>s())),o&&t.addEventListener("versionchange",(t=>o(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),i}("my-database",1,{upgrade(t){t.createObjectStore("models")}});return S=await t.get("models","onsetsAndFrames"),S?console.log("Found model in indexedDB!"):(console.log("Downloading Model ..."),S=new d.S("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),await S.initialize(),await t.put("models",S,"onsetsAndFrames")),C=!0,!0}var j=()=>{const{0:t,1:e}=(0,r.useState)(!1),{0:n,1:d}=(0,r.useState)(null),{0:m,1:p}=(0,r.useState)(null);function f(t,e,n){const r=new Blob([t],{type:n}),o=URL.createObjectURL(r),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}return(0,r.useEffect)((()=>{(async()=>{try{e(await F())}catch(t){console.error("Error initializing model:",t)}})()}),[]),(0,r.useEffect)((()=>{if(n&&t&&("mid"===n.name.split(".")[1]||"midi"===n.name.split(".")[1])){function e(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=t=>{const n=r.result;e(n)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(async()=>{p(s.eo(await e(n)))})()}}),[n,t]),r.createElement(r.Fragment,null,t?r.createElement(r.Fragment,null,r.createElement(u.Z,{onFileUpload:d}),n&&(m?r.createElement(r.Fragment,null,r.createElement(i.Z,{noteSequence:m}),r.createElement(a,{noteSequence:m})):r.createElement("p",null,"Transcribing ..."))):r.createElement("p",null,"Loading Model..."),r.createElement("button",{onClick:()=>{const t=function(t){let e=new s.lZ(t);e.tempos[0].qpm||(e=(0,o.ef)(t));const n=60/(256*e.tempos[0].qpm);let r='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\t<!DOCTYPE score-partwise PUBLIC\n\t\t"-//Recordare//DTD MusicXML 4.0 Partwise//EN"\n\t\t"http://www.musicxml.org/dtds/partwise.dtd">\n\t<score-partwise version="4.0">\n\t  \t<part-list>\n\t\t\t<score-part id="P1">\n\t\t  \t\t<part-name>Music</part-name>\n\t\t\t</score-part>\n\t  \t</part-list>\n\t  \t<part id="P1">\n\t\t  \t',a=e.notes.slice().map((t=>({pitch:t.pitch,startTime:t.startTime,endTime:t.endTime,duration:Math.round((t.endTime-t.startTime)/n),noteType:c[Math.round((t.endTime-t.startTime)/n)],tied:null})));a.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime));let i=[];for(let o=0;o<a.length;o++)for(i.push(a[o]);!i[i.length-1].noteType;)for(let t of Object.keys(c).sort(((t,e)=>e-t)))if(i[i.length-1].duration>t){i[i.length-1].noteType=c[t];break}i.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime)),r+='\n\t\t\t\t<measure number="1">\n\t\t\t\t<attributes>\n\t\t\t\t\t<divisions>256</divisions>\n\t\t\t\t\t<key>\n\t\t\t\t\t  <fifths>0</fifths>\n\t\t\t\t\t</key>\n\t\t\t\t\t<time>\n\t\t\t\t\t  <beats>4</beats>\n\t\t\t\t\t  <beat-type>4</beat-type>\n\t\t\t\t\t</time>\n\t\t\t\t\t<staves>2</staves>\n\t\t\t\t  <clef number="1">\n\t\t\t\t\t\t<sign>G</sign>\n\t\t\t\t\t\t<line>2</line>\n\t\t\t\t  </clef>\n\t\t\t\t  <clef number="2">\n\t\t\t\t\t\t<sign>F</sign>\n\t\t\t\t\t\t<line>4</line>\n\t\t\t\t  </clef>\n\t\t\t  </attributes>';for(let[o,s]of i.entries())r+=`\n\t\t\t<note>\n\t\t\t\t${o>0&&i[o-1].startTime===s.startTime?"<chord />":""}\n\t\t\t\t<pitch>\n\t\t\t\t\t  <step>${l(s.pitch).step}</step>\n\t\t\t\t\t<alter>${l(s.pitch).alter}</alter>\n\t\t\t\t\t  <octave>${l(s.pitch).octave}</octave>\n\t\t\t\t</pitch>\n\t\t\t\t<duration>${s.duration}</duration>\n\t\t\t\t<type>${s.noteType}</type>\n\t\t\t\t${s.tied?s.tied:""}\n\t\t\t</note>\n\t\t\t`;return r+="\n\t\t\t\t</measure>",r+="\n\t\t</part>\n\t</score-partwise>",r}(m);f(t,"music.xml","application/octet-stream")}},"Download MusicXML"),r.createElement("button",{onClick:()=>{f(s.pi(m),"music.midi","application/octet-stream")}},"Download MIDI"))};const x=()=>r.createElement("title",null,"Home Page")}}]);
//# sourceMappingURL=component---src-pages-index-js-4af5d5f8e11500961f6c.js.map