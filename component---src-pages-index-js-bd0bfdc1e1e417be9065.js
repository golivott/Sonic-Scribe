"use strict";(self.webpackChunksonic_scribe=self.webpackChunksonic_scribe||[]).push([[678],{6621:function(t,e,n){n.r(e),n.d(e,{Head:function(){return P},default:function(){return A}});var r=n(7294),o=n(5100),a=n(3688);var s=n(5131);const i={1:"1024th",2:"512th",4:"256th",8:"128th",16:"64th",32:"32th",64:"16th",128:"eighth",256:"quarter",512:"half",1024:"whole",2048:"breve",4096:"long",8192:"maxima"};function c(t){return{step:{0:"A",1:"A",2:"B",3:"C",4:"C",5:"D",6:"D",7:"E",8:"F",9:"F",10:"G",11:"G"}[(t-21)%12],alter:{0:0,1:1,2:0,3:0,4:1,5:0,6:1,7:0,8:0,9:1,10:0,11:1}[(t-21)%12],octave:Math.floor((t-12)/12)}}var l=n(9282),u=n(8784);const d=(t,e)=>e.some((e=>t instanceof e));let m,p;const f=new WeakMap,h=new WeakMap,g=new WeakMap,w=new WeakMap,b=new WeakMap;let y={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return h.get(t);if("objectStoreNames"===e)return t.objectStoreNames||g.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return T(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function v(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(p||(p=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(D(this),e),T(f.get(this))}:function(...e){return T(t.apply(D(this),e))}:function(e,...n){const r=t.call(D(this),e,...n);return g.set(r,e.sort?e.sort():[e]),T(r)}}function E(t){return"function"==typeof t?v(t):(t instanceof IDBTransaction&&function(t){if(h.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",a),t.removeEventListener("abort",a)},o=()=>{e(),r()},a=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",a),t.addEventListener("abort",a)}));h.set(t,e)}(t),d(t,m||(m=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,y):t)}function T(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",a)},o=()=>{e(T(t.result)),r()},a=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",a)}));return e.then((e=>{e instanceof IDBCursor&&f.set(e,t)})).catch((()=>{})),b.set(e,t),e}(t);if(w.has(t))return w.get(t);const e=E(t);return e!==t&&(w.set(t,e),b.set(e,t)),e}const D=t=>b.get(t);const B=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],k=new Map;function L(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(k.get(e))return k.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=I.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!B.includes(n))return;const a=async function(t,...e){const a=this.transaction(t,o?"readwrite":"readonly");let s=a.store;return r&&(s=s.index(e.shift())),(await Promise.all([s[n](...e),o&&a.done]))[0]};return k.set(e,a),a}let M;y=(t=>({...t,get:(e,n,r)=>L(e,n)||t.get(e,n,r),has:(e,n)=>!!L(e,n)||t.has(e,n)}))(y);let F=!1;async function C(){if(F)return!0;const t=await function(t,e,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(t,e),i=T(s);return r&&s.addEventListener("upgradeneeded",(t=>{r(T(s.result),t.oldVersion,t.newVersion,T(s.transaction),t)})),n&&s.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),i.then((t=>{a&&t.addEventListener("close",(()=>a())),o&&t.addEventListener("versionchange",(t=>o(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),i}("my-database",1,{upgrade(t){t.createObjectStore("models")}});return M=await t.get("models","onsetsAndFrames"),M?console.log("Found model in indexedDB!"):(console.log("Downloading Model ..."),M=new u.S("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),await M.initialize(),await t.put("models",M,"onsetsAndFrames")),F=!0,!0}async function S(t){const e=await function(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=n=>{const o=r.result,a=new Blob([o],{type:t.type});e(a)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(t);F||await C();const n=await M.transcribeFromAudioFile(e);return console.log(n),n}var A=()=>{const{0:t,1:e}=(0,r.useState)(!1),{0:n,1:u}=(0,r.useState)(null),{0:d,1:m}=(0,r.useState)(null);function p(t,e,n){const r=new Blob([t],{type:n}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}return(0,r.useEffect)((()=>{(async()=>{try{e(await C())}catch(t){console.error("Error initializing model:",t)}})()}),[]),(0,r.useEffect)((()=>{if(n&&t)if("mid"===n.name.split(".")[1]||"midi"===n.name.split(".")[1]){function e(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=t=>{const n=r.result;e(n)},r.onerror=t=>{n(r.error)},r.readAsArrayBuffer(t)}))}(async()=>{m(a.eo(await e(n)))})()}else{(async()=>{try{let t=await S(n);m(t)}catch(t){console.error("Error transcribing file:",t)}})()}}),[n,t]),r.createElement(r.Fragment,null,t?r.createElement(r.Fragment,null,r.createElement(l.Z,{onFileUpload:u}),n&&(d?r.createElement(r.Fragment,null,r.createElement(s.Z,{noteSequence:d})):r.createElement("p",null,"Transcribing ..."))):r.createElement("p",null,"Loading Model..."),r.createElement("button",{onClick:()=>{const t=function(t){let e=new a.lZ(t);e.tempos[0].qpm||(e=(0,o.ef)(t));const n=60/(256*e.tempos[0].qpm);let r='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\t<!DOCTYPE score-partwise PUBLIC\n\t\t"-//Recordare//DTD MusicXML 4.0 Partwise//EN"\n\t\t"http://www.musicxml.org/dtds/partwise.dtd">\n\t<score-partwise version="4.0">\n\t  \t<part-list>\n\t\t\t<score-part id="P1">\n\t\t  \t\t<part-name>Music</part-name>\n\t\t\t</score-part>\n\t  \t</part-list>\n\t  \t<part id="P1">\n\t\t  \t',s=e.notes.slice().map((t=>({pitch:t.pitch,startTime:t.startTime,endTime:t.endTime,duration:Math.round((t.endTime-t.startTime)/n),noteType:i[Math.round((t.endTime-t.startTime)/n)],tied:null})));s.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime));let l=[];for(let o=0;o<s.length;o++)for(l.push(s[o]);!l[l.length-1].noteType;)for(let t of Object.keys(i).sort(((t,e)=>e-t)))if(l[l.length-1].duration>t){l[l.length-1].noteType=i[t];break}l.sort(((t,e)=>t.startTime===e.startTime?t.endTime-e.endTime:t.startTime-e.startTime)),r+='\n\t\t\t\t<measure number="1">\n\t\t\t\t<attributes>\n\t\t\t\t\t<divisions>256</divisions>\n\t\t\t\t\t<key>\n\t\t\t\t\t  <fifths>0</fifths>\n\t\t\t\t\t</key>\n\t\t\t\t\t<time>\n\t\t\t\t\t  <beats>4</beats>\n\t\t\t\t\t  <beat-type>4</beat-type>\n\t\t\t\t\t</time>\n\t\t\t\t\t<staves>2</staves>\n\t\t\t\t  <clef number="1">\n\t\t\t\t\t\t<sign>G</sign>\n\t\t\t\t\t\t<line>2</line>\n\t\t\t\t  </clef>\n\t\t\t\t  <clef number="2">\n\t\t\t\t\t\t<sign>F</sign>\n\t\t\t\t\t\t<line>4</line>\n\t\t\t\t  </clef>\n\t\t\t  </attributes>';for(let[o,a]of l.entries())r+=`\n\t\t\t<note>\n\t\t\t\t${o>0&&l[o-1].startTime===a.startTime?"<chord />":""}\n\t\t\t\t<pitch>\n\t\t\t\t\t  <step>${c(a.pitch).step}</step>\n\t\t\t\t\t<alter>${c(a.pitch).alter}</alter>\n\t\t\t\t\t  <octave>${c(a.pitch).octave}</octave>\n\t\t\t\t</pitch>\n\t\t\t\t<duration>${a.duration}</duration>\n\t\t\t\t<type>${a.noteType}</type>\n\t\t\t\t${a.tied?a.tied:""}\n\t\t\t</note>\n\t\t\t`;return r+="\n\t\t\t\t</measure>",r+="\n\t\t</part>\n\t</score-partwise>",r}(d);p(t,"music.xml","application/octet-stream")}},"Download MusicXML"),r.createElement("button",{onClick:()=>{p(a.pi(d),"music.midi","application/octet-stream")}},"Download MIDI"))};const P=()=>r.createElement("title",null,"Home Page")}}]);
//# sourceMappingURL=component---src-pages-index-js-bd0bfdc1e1e417be9065.js.map